<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vagas Turbo - Painel de Controle</title>
    <style>
        body { font-family: Arial, sans-serif; background-color: #f4f4f4; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        h1 { color: #333; }
        label { display: block; margin-top: 15px; font-weight: bold; }
        input[type="number"], input[type="text"] { width: 100%; padding: 10px; margin-top: 5px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        button { background-color: #2ecc71; color: white; padding: 12px 20px; border: none; border-radius: 4px; cursor: pointer; margin-top: 20px; font-size: 16px; }
        button:hover { background-color: #27ae60; }
        textarea { width: 100%; height: 80px; padding: 10px; margin-top: 5px; border: 1px solid #ccc; border-radius: 4px; resize: none; }
        #mensagem-status { margin-top: 20px; padding: 10px; border-radius: 4px; display: none; }
    </style>
</head>
<body>

<div class="container">
    <h1>üöÄ Vagas Turbo - Painel de Controle</h1>
    <p>Configure o n√∫mero de vagas e gere seu c√≥digo de instala√ß√£o.</p>
    
    <div id="mensagem-status"></div>

    <form id="config-form">
        <label for="widgetID">Seu ID Exclusivo de Widget:</label>
        <input type="text" id="widgetID" value="ID-DO-SEU-PRIMEIRO-CLIENTE" required readonly>

        <label for="vagasTotais">1. Vagas Totais na Oferta:</label>
        <input type="number" id="vagasTotais" value="100" required min="1">

        <label for="vendasReais">2. Vendas Atuais (Preenchimento Manual):</label>
        <input type="number" id="vendasReais" value="50" required min="0">

        <button type="submit">3. SALVAR CONFIGURA√á√ïES E ATUALIZAR WIDGET</button>
    </form>

    <hr style="margin: 30px 0;">

    <h2>C√≥digo de Instala√ß√£o (Copiar e Colar)</h2>
    <p>Copie este c√≥digo *exatamente* como est√° e cole antes do fechamento da tag <code>&lt;/body&gt;</code> na sua p√°gina de vendas.</p>
    <textarea id="codigo-widget" readonly></textarea>
</div>

<script>
    const API_CONFIG_URL = window.location.origin + '/api/config'; 

    const widgetID = document.getElementById('widgetID').value;
    const codigoWidget = document.getElementById('codigo-widget');
    const statusMessage = document.getElementById('mensagem-status');

    // 1. Gera o c√≥digo de instala√ß√£o
    codigoWidget.value = `<script src="${window.location.origin}/widget.js" data-widget-id="${widgetID}"><\/script>`;

    // 2. Envia os dados para a API
    document.getElementById('config-form').addEventListener('submit', async (e) => {
        e.preventDefault();

        const data = {
            widgetID: widgetID,
            vagasTotais: document.getElementById('vagasTotais').value,
            vendasReais: document.getElementById('vendasReais').value,
        };

        try {
            const response = await fetch(API_CONFIG_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data),
            });

            const result = await response.json();

            statusMessage.style.display = 'block';
            if (response.ok) {
                statusMessage.style.backgroundColor = '#d4edda';
                statusMessage.style.color = '#155724';
                statusMessage.innerHTML = '‚úÖ **SUCESSO!** Configura√ß√µes salvas. O widget ser√° atualizado em 10 segundos.';
            } else {
                statusMessage.style.backgroundColor = '#f8d7da';
                statusMessage.style.color = '#721c24';
                statusMessage.innerHTML = `‚ùå Erro ao salvar: ${result.message || 'Verifique o console.'}`;
            }

        } catch (error) {
            statusMessage.style.display = 'block';
            statusMessage.style.backgroundColor = '#f8d7da';
            statusMessage.style.color = '#721c24';
            statusMessage.innerHTML = '‚ùå Erro de conex√£o com a API. Verifique sua URL.';
            console.error('Fetch Error:', error);
        }
    });

</script>
</body>
</html>